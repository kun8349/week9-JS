{"version":3,"sources":["admin.js"],"names":["dataAdmin","document","querySelector","delAll","orderData","init","renderOrderList","headers","axios","get","api_path","config","then","res","data","orders","renderOrderHTML","err","console","log","str","renderC3","sort","a","b","createdAt","forEach","item","time","Date","changeTime","getFullYear","getMonth","getDate","productStr","products","title","quantity","status","paid","id","user","name","tel","address","email","innerHTML","totalObj","c3Data","product","undefined","price","Object","entries","length","otherC3","index","splice","push","chart","c3","generate","bindto","type","columns","colors","addEventListener","e","preventDefault","target","nodeName","statusId","getAttribute","statusOrder","orderStatus","deleteId","orderDelete","newStatus","put","alert","orderDeleteAll"],"mappings":"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","sourcesContent":["//DOM訂單資訊\r\nconst dataAdmin = document.querySelector('[data-admin]');\r\n//DOM刪除全部\r\nconst delAll = document.querySelector('.js-delAll');\r\n\r\n//訂單資訊\r\nlet orderData = [];\r\n//初始化網站\r\nfunction init(){\r\n    renderOrderList();\r\n    \r\n}\r\ninit();\r\n\r\n//headers\r\nfunction headers(){\r\n\r\n}\r\n\r\n//渲染訂單資訊\r\nfunction renderOrderList(){\r\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,config)\r\n    .then(res=>{\r\n        orderData=res.data.orders;\r\n        renderOrderHTML();\r\n        \r\n    })\r\n    .catch(err=>{\r\n        console.log(err);\r\n    })\r\n       \r\n}\r\n//渲染訂單資訊函式\r\nfunction renderOrderHTML(){\r\n    let str = '';\r\n        renderC3();\r\n        orderData.sort((a,b)=>{\r\n            return a.createdAt - b.createdAt\r\n        })\r\n        orderData.forEach(item => {\r\n            \r\n            //訂單時間\r\n            const time = new Date(item.createdAt*1000);\r\n            const changeTime = `${time.getFullYear()}/${time.getMonth()+1}/${time.getDate()}`\r\n            //組合產品字串\r\n            let productStr = '';\r\n            item.products.forEach(item=>{\r\n                productStr += `<p>${item.title} X${item.quantity}</p>`;\r\n            })\r\n            //訂單狀態\r\n            let status = '';\r\n            if(item.paid === false){\r\n                status = '未處理'\r\n            }else if(item.paid === true){\r\n                status = '已處理'\r\n            }\r\n            //渲染order list\r\n            str += `<tr>\r\n                <td>${item.id}</td>\r\n                <td>\r\n                    <p>${item.user.name}</p>\r\n                    <p>${item.user.tel}</p>\r\n                </td>\r\n                <td>${item.user.address}</td>\r\n                <td>${item.user.email}</td>\r\n                <td data-productHTML>\r\n                   ${productStr}\r\n                </td>\r\n                <td>${changeTime}</td>\r\n                <td class=\"orderStatus-admin\">\r\n                    <a href=\"#\" data-status='${item.paid}' data-id='${item.id}'>${status}</a>\r\n                </td>\r\n                <td>\r\n                    <input type=\"button\" class=\"delSingleOrder-Btn\" value=\"刪除\" data-id='${item.id}'>\r\n                </td>\r\n            </tr>`\r\n        });\r\n        dataAdmin.innerHTML=str;\r\n}\r\n//C3\r\nfunction renderC3(){\r\n    //C3\r\n    let totalObj = {};\r\n    let c3Data = []; \r\n    //1.轉物件{床架: 24000,收納: 2670,窗簾: 1200}\r\n    orderData.forEach(item=>{\r\n        item.products.forEach(product=>{\r\n            if(totalObj[product.title]==undefined){\r\n                totalObj[product.title] = product.price*product.quantity;\r\n            }else{\r\n                totalObj[product.title] += product.price*product.quantity;\r\n            }\r\n        })\r\n    })\r\n    // 2.轉成[['收納', 2670],['床架', 24000],['窗簾', 1200]];\r\n    c3Data = Object.entries(totalObj);\r\n    // 新增排序\r\n    c3Data.sort((a,b)=>{\r\n        return b[1] - a[1];\r\n    })\r\n    //新增比數>3剩餘丟其他\r\n    if(c3Data.length>3){\r\n        let otherC3 = 0;\r\n        c3Data.forEach((item,index)=>{\r\n            if(index>2){\r\n                otherC3 += c3Data[index][1];\r\n            }\r\n        })\r\n        c3Data.splice(3,c3Data.length - 1);\r\n        c3Data.push(['其他',otherC3]);\r\n    }\r\n    // 3.丟進套件\r\n    let chart = c3.generate({\r\n        bindto: '#chart', \r\n        data: {\r\n            type: \"pie\",\r\n            columns: c3Data,\r\n            colors:{\r\n                \"Charles 系列儲物組合\":\"#DACBFF\",\r\n                \"Louvre 單人床架\":\"#5434A7\",\r\n                \"Antony 雙人床架／雙人加大\": \"#9D7FEA\",\r\n                \"其他\": \"#301E5F\",\r\n            }\r\n        },\r\n    });\r\n}\r\n//\r\n\r\n//訂單狀態+單筆刪除\r\ndataAdmin.addEventListener('click',e=>{\r\n    e.preventDefault();\r\n    if(e.target.nodeName == 'TD' || e.target.nodeName == 'P'){return}\r\n    //訂單狀態\r\n    if(e.target.nodeName === 'A'){\r\n        let statusId = e.target.getAttribute('data-id');\r\n        \r\n        let statusOrder ;\r\n        if(e.target.getAttribute('data-status')==='false'){\r\n            statusOrder = false;\r\n        }else{\r\n            statusOrder = true;\r\n        }\r\n        orderStatus(statusId,statusOrder);\r\n        \r\n    }\r\n    //單筆刪除\r\n    if(e.target.nodeName === 'INPUT'){\r\n        let deleteId = e.target.getAttribute('data-id');\r\n        orderDelete(deleteId);\r\n    }\r\n})\r\n//修改狀態函式\r\nfunction orderStatus(id,status){\r\n    let newStatus;\r\n    if(status === false){\r\n        newStatus = true;\r\n    }else{\r\n        newStatus = false;\r\n    }\r\n\r\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,{\r\n        \"data\": {\r\n            \"id\": id,\r\n            \"paid\": newStatus\r\n          }\r\n        },config)\r\n    .then(res=>{\r\n        alert('訂單狀態修改成功')\r\n        renderOrderList();\r\n    })\r\n    .catch(err=>{\r\n        console.log(err);\r\n    })\r\n}\r\n//刪除單筆函式\r\nfunction orderDelete(id){\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${id}`,config)\r\n    .then(res=>{\r\n        alert('單筆刪除成功');\r\n        renderOrderList();\r\n    })\r\n    .catch(err=>{\r\n        console.log(err.data);\r\n    })\r\n}\r\n\r\n//全部刪除\r\ndelAll.addEventListener('click',e=>{\r\n    e.preventDefault();\r\n    orderDeleteAll();\r\n    \r\n})\r\nfunction orderDeleteAll(){\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\r\n    config)\r\n    .then(res=>{\r\n        alert('全部刪除成功');\r\n        renderOrderList();\r\n    })\r\n    .catch(err=>{\r\n        console.log(err.data);\r\n    })\r\n}\r\n\r\n\r\n\r\n"],"file":"admin.js"}