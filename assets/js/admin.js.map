{"version":3,"sources":["admin.js"],"names":["dataAdmin","document","querySelector","delAll","orderData","init","renderOrderList","renderC3","totalObj","c3Data","forEach","item","products","product","category","undefined","price","quantity","Object","entries","chart","c3","generate","bindto","data","type","columns","colors","axios","get","api_path","headers","token","then","res","orders","str","time","Date","createdAt","changeTime","getFullYear","getMonth","getDate","productStr","title","status","paid","id","user","name","tel","address","email","innerHTML","err","console","log","addEventListener","e","preventDefault","target","nodeName","statusId","getAttribute","statusOrder","orderStatus","deleteId","orderDelete","newStatus","put","alert","orderDeleteAll"],"mappings":"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","sourcesContent":["\r\n\r\n\r\n//DOM訂單資訊\r\nconst dataAdmin = document.querySelector('[data-admin]');\r\n//DOM刪除全部\r\nconst delAll = document.querySelector('.js-delAll');\r\n\r\n//訂單資訊\r\nlet orderData = [];\r\n//初始化網站\r\nfunction init(){\r\n    renderOrderList();\r\n    \r\n}\r\ninit();\r\n\r\n//C3\r\nfunction renderC3(){\r\n    //C3\r\n    let totalObj = {};\r\n    let c3Data = []; \r\n    //1.轉物件{床架: 24000,收納: 2670,窗簾: 1200}\r\n    orderData.forEach(item=>{\r\n        item.products.forEach(product=>{\r\n            if(totalObj[product.category]==undefined){\r\n                totalObj[product.category] = product.price*product.quantity;\r\n            }else{\r\n                totalObj[product.category] += product.price*product.quantity;\r\n            }\r\n        })\r\n    })\r\n    // 2.轉成[['收納', 2670],['床架', 24000],['窗簾', 1200]];\r\n    c3Data = Object.entries(totalObj);\r\n    // 3.丟進套件\r\n    let chart = c3.generate({\r\n        bindto: '#chart', \r\n        data: {\r\n            type: \"pie\",\r\n            columns: c3Data,\r\n            colors:{\r\n                \"床架\":\"#DACBFF\",\r\n                \"窗簾\":\"#5434A7\",\r\n                \"收納\": \"#9D7FEA\",\r\n                \"其他\": \"#301E5F\",\r\n            }\r\n        },\r\n    });\r\n}\r\n\r\n//渲染訂單資訊\r\nfunction renderOrderList(){\r\n    axios.get(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,{\r\n        headers:{\r\n            'Authorization':token,\r\n        } \r\n    })\r\n    .then(res=>{\r\n        orderData=res.data.orders;\r\n        let str = '';\r\n        renderC3();\r\n        orderData.forEach(item => {\r\n            \r\n            //訂單時間\r\n            const time = new Date(item.createdAt*1000);\r\n            const changeTime = `${time.getFullYear()}/${time.getMonth()+1}/${time.getDate()}`\r\n            //組合產品字串\r\n            let productStr = '';\r\n            item.products.forEach(item=>{\r\n                productStr += `<p>${item.title} X${item.quantity}</p>`;\r\n            })\r\n            //訂單狀態\r\n            let status = '';\r\n            if(item.paid === false){\r\n                status = '未處理'\r\n            }else if(item.paid === true){\r\n                status = '已處理'\r\n            }\r\n            //渲染order list\r\n            str += `<tr>\r\n                <td>${item.id}</td>\r\n                <td>\r\n                    <p>${item.user.name}</p>\r\n                    <p>${item.user.tel}</p>\r\n                </td>\r\n                <td>${item.user.address}</td>\r\n                <td>${item.user.email}</td>\r\n                <td data-productHTML>\r\n                   ${productStr}\r\n                </td>\r\n                <td>${changeTime}</td>\r\n                <td class=\"orderStatus-admin\">\r\n                    <a href=\"#\" data-status='${item.paid}' data-id='${item.id}'>${status}</a>\r\n                </td>\r\n                <td>\r\n                    <input type=\"button\" class=\"delSingleOrder-Btn\" value=\"刪除\" data-id='${item.id}'>\r\n                </td>\r\n            </tr>`\r\n        });\r\n        dataAdmin.innerHTML=str;\r\n        \r\n    })\r\n    .catch(err=>{\r\n        console.log(err);\r\n    })\r\n       \r\n}\r\n\r\n//訂單狀態+單筆刪除\r\ndataAdmin.addEventListener('click',e=>{\r\n    e.preventDefault();\r\n    if(e.target.nodeName == 'TD' || e.target.nodeName == 'P'){return}\r\n    //訂單狀態\r\n    if(e.target.nodeName === 'A'){\r\n        let statusId = e.target.getAttribute('data-id');\r\n        \r\n        let statusOrder ;\r\n        if(e.target.getAttribute('data-status')==='false'){\r\n            statusOrder = false;\r\n        }else{\r\n            statusOrder = true;\r\n        }\r\n        orderStatus(statusId,statusOrder);\r\n        \r\n    }\r\n    //單筆刪除\r\n    if(e.target.nodeName === 'INPUT'){\r\n        let deleteId = e.target.getAttribute('data-id');\r\n        orderDelete(deleteId);\r\n    }\r\n})\r\n//修改狀態函式\r\nfunction orderStatus(id,status){\r\n    let newStatus;\r\n    if(status === false){\r\n        newStatus = true;\r\n    }else{\r\n        newStatus = false;\r\n    }\r\n\r\n    axios.put(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,{\r\n        \"data\": {\r\n            \"id\": id,\r\n            \"paid\": newStatus\r\n          }\r\n        },{\r\n        headers:{\r\n            'Authorization':token,\r\n        } \r\n    })\r\n    .then(res=>{\r\n        alert('訂單狀態修改成功')\r\n        renderOrderList();\r\n    })\r\n    .catch(err=>{\r\n        console.log(err);\r\n    })\r\n}\r\n//刪除單筆函式\r\nfunction orderDelete(id){\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders/${id}`,\r\n    {\r\n        headers:{\r\n            'Authorization':token,\r\n        } \r\n    })\r\n    .then(res=>{\r\n        alert('單筆刪除成功');\r\n        renderOrderList();\r\n    })\r\n    .catch(err=>{\r\n        console.log(err.data);\r\n    })\r\n}\r\n\r\n//全部刪除\r\ndelAll.addEventListener('click',e=>{\r\n    e.preventDefault();\r\n    orderDeleteAll();\r\n    \r\n})\r\nfunction orderDeleteAll(){\r\n    axios.delete(`https://livejs-api.hexschool.io/api/livejs/v1/admin/${api_path}/orders`,\r\n    {\r\n        headers:{\r\n            'Authorization':token,\r\n        } \r\n    })\r\n    .then(res=>{\r\n        alert('全部刪除成功');\r\n        renderOrderList();\r\n    })\r\n    .catch(err=>{\r\n        console.log(err.data);\r\n    })\r\n}\r\n\r\n\r\n\r\n\r\n//優化\r\n//1.餅圖\r\n//2.小數點"],"file":"admin.js"}